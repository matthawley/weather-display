text_sensor:
  - platform: homeassistant
    id: weather_state
    entity_id: weather.precipitation_station
    filters:
      - to_lower:
    on_value:
      then:
        - script.execute: update_weather_icon

time:
  - id: current_date
    platform: homeassistant
    on_time_sync:
      - script.execute: date_update
    on_time:
      - minutes: /1
        seconds: 0
        then:
          - script.execute: date_update

script:
  - id: update_weather_icon
    then:
      - if:
          condition:
            text_sensor.state:
              id: weather_state
              state: clear-night
          then:
            - lvgl.image.update:
                id: img_weather_forecast_icon
                src: clear_night
            - lvgl.label.update:
                id: lbl_weather_forecast_condition_state
                text: "CLEAR NIGHT"
      - if:
          condition:
            text_sensor.state:
              id: weather_state
              state: cloudy
          then:
            - lvgl.image.update:
                id: img_weather_forecast_icon
                src: cloudy
            - lvgl.label.update:
                id: lbl_weather_forecast_condition_state
                text: "CLOUDY"
      - if:
          condition:
            text_sensor.state:
              id: weather_state
              state: fog
          then:
            - lvgl.image.update:
                id: img_weather_forecast_icon
                src: foggy
            - lvgl.label.update:
                id: lbl_weather_forecast_condition_state
                text: "FOGGY"
      - if:
          condition:
            text_sensor.state:
              id: weather_state
              state: partlycloudy
          then:
            - lvgl.image.update:
                id: img_weather_forecast_icon
                src: partly_cloudy
            - lvgl.label.update:
                id: lbl_weather_forecast_condition_state
                text: "PARTLY CLOUDY"
      - if:
          condition:
            text_sensor.state:
              id: weather_state
              state: rainy
          then:
            - lvgl.image.update:
                id: img_weather_forecast_icon
                src: rainy
            - lvgl.label.update:
                id: lbl_weather_forecast_condition_state
                text: "RAINY"
      - if:
          condition:
            text_sensor.state:
              id: weather_state
              state: snowy
          then:
            - lvgl.image.update:
                id: img_weather_forecast_icon
                src: snowy
            - lvgl.label.update:
                id: lbl_weather_forecast_condition_state
                text: "SNOWY"
      - if:
          condition:
            text_sensor.state:
              id: weather_state
              state: snow-rainy
          then:
            - lvgl.image.update:
                id: img_weather_forecast_icon
                src: snowy
            - lvgl.label.update:
                id: lbl_weather_forecast_condition_state
                text: "RAINY SNOW"
      - if:
          condition:
            text_sensor.state:
              id: weather_state
              state: lightning-rainy
          then:
            - lvgl.image.update:
                id: img_weather_forecast_icon
                src: stormy
            - lvgl.label.update:
                id: lbl_weather_forecast_condition_state
                text: "THUNDERSTORM"
      - if:
          condition:
            text_sensor.state:
              id: weather_state
              state: sunny
          then:
            - lvgl.image.update:
                id: img_weather_forecast_icon
                src: sunny
            - lvgl.label.update:
                id: lbl_weather_forecast_condition_state
                text: "CLEAR SKY"
      - if:
          condition:
            text_sensor.state:
              id: weather_state
              state: lightning
          then:
            - lvgl.image.update:
                id: img_weather_forecast_icon
                src: thunder
            - lvgl.label.update:
                id: lbl_weather_forecast_condition_state
                text: "THUNDER"
      - if:
          condition:
            text_sensor.state:
              id: weather_state
              state: windy
          then:
            - lvgl.image.update:
                id: img_weather_forecast_icon
                src: windy
            - lvgl.label.update:
                id: lbl_weather_forecast_condition_state
                text: "WINDY"

- id: date_update
  then:
    - lvgl.label.update:
        id: lbl_weather_forecast_condition_date
        text: !lambda |-
          static const char * const mon_names[] = {"JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"};
          static char date_buf[8];
          auto now = id(current_date).now();
          snprintf(date_buf, sizeof(date_buf), "%s %2d %s, ", mon_names[now.month-1], now.day_of_month, now.year);
          return date_buf;